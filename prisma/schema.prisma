generator client {
  provider = "prisma-client-js"
   output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"

}

// --------------------
// ENUMS
// --------------------

enum AdminRole {
  tournamentManager
  superAdmin
}

enum Status {
  upComing
  onGoing
  finished
}

enum GoalType {
  normal
  penalty
  ownGoal
}

enum EventType {
  Goal
  Yellow
  Red
}
enum MediaType {
  teamLogo
  playerImage
  tournamentImage
  matchImage
}
// --------------------
// MODELS
// --------------------

// ADMIN
model Admin {
  id                  String           @id @default(uuid())
  email               String           @unique
  fullName            String
  password            String
  username            String           @unique
  accessToken         String?
  refreshToken        String?
  role                AdminRole @default(tournamentManager)
  isActive            Boolean @default(true)


  // Relations
  tournaments         Tournament[]     @relation("ManagedTournaments")
  sentNotifications   Notifications[]  @relation("Sender")
  receivedNotifications Notifications[] @relation("Receiver")
}


// PLAYER
model Player {
  id        String     @id @default(uuid())
  name      String
  position  String
  number    Int        @default(99)
  teamId    String

  // Relations
  playerMatchStats PlayerMatchStats[]
  team      Team       @relation(fields: [teamId], references: [id])
  events    MatchEvent[]
  goalScore GoalScorer[]
  @@unique([teamId, number])
}


// TEAM
model Team {
  id         String     @id @default(uuid())
  teamName   String
  logo       String
  power Int @default(0)

//relation
  players      Player[]
  matchEvent   MatchEvent[]
  homeMatches  Match[]    @relation("HomeTeam")
  awayMatches  Match[]    @relation("AwayTeam")
  standings     TournamentStanding[] 
  tournaments  TournamentTeam[]
}

// TOURNAMENT
model Tournament {
  id             String     @id @default(uuid())
  managerId      String
  tournamentName String
  startingDate   String
  endingDate     String
  description    String
  venue          String?
  sponsor        String?
  status         Status
//relation
  manager        Admin       @relation("ManagedTournaments", fields: [managerId], references: [id])
  teams          TournamentTeam[]
  matches        Match[]
  standings      TournamentStanding[]   
  mediaGallery   MediaGallery[]
}

// TOURNAMENT TEAM (JUNCTION TABLE)
model TournamentTeam {
  id           String    @id @default(uuid())
  tournamentId String
  teamId       String

  tournament   Tournament @relation(fields: [tournamentId], references: [id])
  team         Team       @relation(fields: [teamId], references: [id])

  @@unique([tournamentId, teamId]) // prevent duplicate registrations
}

model PlayerMatchStats {
  id        String @id @default(uuid())
  playerId  String
  matchId   String

  goals     Int @default(0)
  assists   Int @default(0)
  yellow    Int @default(0)
  red       Int @default(0)
  minutes   Int @default(0)

  player    Player @relation(fields: [playerId], references: [id])
  match     Match  @relation(fields: [matchId], references: [id])

  @@unique([playerId, matchId])
}



// MATCH
model Match {
  id            String       @id @default(uuid())
  tournamentId  String
  scheduledDate String
  homeTeamId    String
  awayTeamId    String
  venue         String
  referee       String
  status        Status
  homeScore     Int @default(0)
  awayScore     Int @default(0)
  matchWeek Int?


  // Relations
  playerMatchStats PlayerMatchStats[]
  tournament    Tournament   @relation(fields: [tournamentId], references: [id])
  homeTeam      Team         @relation("HomeTeam", fields: [homeTeamId], references: [id])
  awayTeam      Team         @relation("AwayTeam", fields: [awayTeamId], references: [id])
  events        MatchEvent[]
  goalScore     GoalScorer[]

  matchStats    MatchStats?
  @@unique([homeTeamId, awayTeamId, scheduledDate])

}


// MATCH EVENTS
model MatchEvent {
  id          String     @id @default(ulid())
  matchId     String
  playerId    String
  eventTeamId String
  minute      Int
  eventType   EventType

//relation
  match       Match      @relation(fields: [matchId], references: [id])
  player      Player     @relation(fields: [playerId], references: [id])
  team        Team       @relation(fields: [eventTeamId],references: [id])

}


// GOAL SCORERS
model GoalScorer {
  id        String     @id @default(uuid())
  playerId  String
  matchId   String
  goaltype  GoalType    @default(normal)
  minute    Int

  match     Match       @relation(fields: [matchId], references: [id])
  player    Player      @relation(fields: [playerId], references: [id])
}


// MATCH STATS (Required for AI & Predictions)
model MatchStats {
  id             String   @id @default(uuid())
  matchId        String   @unique
  possessionHome Float?
  possessionAway Float?
  shotsHome      Int?
  shotsAway      Int?
  shotsOnTargetHome Int?
  shotsOnTargetAway Int?
  foulsHome      Int?
  foulsAway      Int?
  cornersHome    Int?
  cornersAway    Int?

  match          Match    @relation(fields: [matchId], references: [id])
}


// MEDIA
model MediaGallery {
  id            String     @id @default(uuid())
  url           String
  type          MediaType
  tournamentId  String?
  teamId        String?
  playerId      String?
  matchId       String?

  tournament    Tournament? @relation(fields: [tournamentId], references: [id])
  // team          Team?       @relation(fields: [teamId], references: [id])
  // player        Player?     @relation(fields: [playerId], references: [id])
  // match         Match?      @relation(fields: [matchId], references: [id])
}


// NOTIFICATIONS
model Notifications {
  id              String  @id @default(uuid())
  receiverAdminId String?
  senderAdminId   String
  message         String
  isSent          Boolean @default(false)
  isAnnouncement   Boolean @default(false)

  sender          Admin   @relation("Sender", fields: [senderAdminId], references: [id])
  receiver        Admin?   @relation("Receiver", fields: [receiverAdminId], references: [id])

}

model TournamentStanding {
  id             String     @id @default(uuid())
  tournamentId   String
  teamId         String

  // Standings Metrics
  played         Int        @default(0)
  wins           Int        @default(0)
  draws          Int        @default(0)
  losses         Int        @default(0)
  goalsFor       Int        @default(0)
  goalsAgainst   Int        @default(0)
  goalDifference Int        @default(0)
  points         Int        @default(0)
  rank           Int?
  form           String? 
  // Relations
  tournament     Tournament @relation(fields: [tournamentId], references: [id])
  team           Team       @relation(fields: [teamId], references: [id])

  @@unique([tournamentId, teamId]) // A team can't have 2 records in same tournament
}

